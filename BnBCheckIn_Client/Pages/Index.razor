@page "/"
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject IJSRuntime jsRuntime
@inject NavigationManager navManager

<div class="row p-0 m-0">
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4 texthero">B&ampB Check In</h1>
            <h3>Boek hier de mooiste B&ampB's uit Vlaanderen.</h3>
        </div>
    </div>
</div>
<EditForm Model="HomeModel" OnValidSubmit="SaveInitialData">
    <DataAnnotationsValidator />
    <div class="row p-0 mx-0 mt-4 mb-4">

        <div class="col-8 col-md-3  offset-md-1 pl-2  pr-2 pr-md-0">
            <div class="form-group">
                <label>Incheckdatum</label>
                <InputDate min="@DateTime.Now.ToString("dd-MM-yyyy")" @bind-Value="HomeModel.StartDate"
                             class="form-control" />
                <ValidationMessage For="()=>HomeModel.StartDate" />
            </div>
        </div>

        <div class="col-8 col-md-3 offset-md-1 pl-2 pl-2 pr-2">
            <div class="form-group">
                <label>Uitcheckdatum</label>
                <InputDate min="@HomeModel.StartDate.AddDays(1).ToString("dd-MM-yyyy")"
                           @bind-Value="HomeModel.EndDate" class="form-control" />
                <ValidationMessage For="()=>HomeModel.EndDate" />
            </div>
        </div>

        <div class="col-4 col-md-2 p-0 pr-2">
            <div class="form-group">
                <label>&nbsp;</label>

                <input type="submit" value="Go" class="btn btn-success btn-block" />

            </div>
        </div>

    </div>
</EditForm>

@code{
    public HomeVM HomeModel { get; set; } = new HomeVM();

    private async Task SaveInitialData()
    {
        try
        {
            HomeModel.NoOfNights = (HomeModel.EndDate - HomeModel.StartDate).Days;
            if (HomeModel.NoOfNights < 0 )
            {
                await jsRuntime.SweetAlertError("Aantal nachten kan niet negatief zijn. Probeer opnieuw.");
                return;
            }
            else
            {
                await localStorage.SetItemAsync(LocalStorage.LS_InitialBooking, HomeModel);

                navManager.NavigateTo("bnb/rooms", forceLoad: true);
            }


        }
        catch (Exception)
        {
            await jsRuntime.SweetAlertError("Er is iets misgegaan bij het ingeven van jouw voorkeurdata. Probeer opnieuw.");
        }
    }
}